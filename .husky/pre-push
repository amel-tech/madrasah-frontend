# Branch name validation
BRANCH_NAME=$(git rev-parse --abbrev-ref HEAD)
MAX_LENGTH=65
PATTERN="^((feature|bugfix|hotfix|chore|release|experiment)/[a-z0-9-]+)|main|(release-please--branches[a-z0-9-]+)$"

if ! echo "$BRANCH_NAME" | grep -Eq "$PATTERN"; then
  echo "Error: Branch name '$BRANCH_NAME' does not follow the naming convention."
  echo "Format: {feature|bugfix|hotfix|chore|release|experiment}/{description}"
  echo "Description should use only lowercase letters, numbers, and hyphens"
  exit 1
fi

if [ ${#BRANCH_NAME} -gt $MAX_LENGTH ]; then
  echo "Error: Branch name is too long (${#BRANCH_NAME} chars)"
  echo "Maximum allowed length is $MAX_LENGTH characters"
  exit 1
fi

npm run build || exit 1